<!DOCTYPE html>
<html lang="en" data-theme="dark">
    <!--
        Kooraseru - A multilingual website
        Single index.html with JSON-based translations
        Subdomain determines language: jp.kooraseru.com = Japanese
    -->
    <head lang="en">
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="My personal website!">
        
        <title>Kooraseru</title>
        <base href="/">

        <link rel="icon" href="public/kooraseru.ico" type="image/x-icon" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" />
        <link rel="stylesheet" href="frontend/src/css/stylesheet.css" />
        <link rel="stylesheet" href="frontend/src/css/themes.css" />
        <link rel="stylesheet" href="frontend/src/css/topbar.css" />
        
        <!-- Theme manager - runs immediately to prevent flash -->
        <script type="module" src="frontend/src/js/theme-manager.js"></script>
        
        <!-- Language system - loads translations and sets font -->
        <script type="module" src="frontend/src/js/language-system.js"></script>
    </head>
    <body>
        <!-- Top Navigation Bar -->
        <nav class="topbar">
            <div class="topbar-content">
                <div class="topbar-left">
                    <div>
                        <!-- Placeholder for future navigation links -->
                        <a href="" class="section-text">About</a>
                        <a href="" class="section-text">Contact</a>
                    </div>
                </div>
                
                <div class="topbar-center">
                    <div class="logo">
                        <img src="public/favicon.ico" alt="Kooraseru" class="logo-icon" data-i18n="topbar.logoAlt" />
                        <span class="logo-text">Kooraseru</span>
                    </div>
                </div>
                
                <div class="topbar-right">
                    <div class="language-selector">
                        <button class="language-toggle-button" id="languageToggle" aria-label="Select language">
                            <span class="language-current" data-i18n="languageSelector.english">English</span>
                            <svg class="language-icon" viewBox="0 0 24 24">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        
                        <!-- Language Dropdown Menu -->
                        <div class="language-dropdown" id="languageDropdown">
                            <div class="language-dropdown-content">
                                <a href="https://kooraseru.com" class="language-option" data-lang="en" data-i18n="languageSelector.english" aria-label="English">English</a>
                                <a href="https://jp.kooraseru.com" class="language-option" data-lang="ja" data-i18n="languageSelector.japanese" aria-label="日本語">日本語</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="content">
            <div class="container">
                <!-- Content will be loaded here -->
                 <h1>
                    Hiya!
                 </h1>
                 <h2>
                    Welcome to my personal website!
                 </h2>
            </div>
        </main>

        <!-- Theme Toggle Button -->
        <div class="theme-toggle-container">
            <button class="theme-toggle-button" id="themeToggle">
                <svg class="theme-icon" viewBox="0 0 24 24">
                    <!-- Sun icon for light theme -->
                    <circle class="sun-circle" cx="12" cy="12" r="5"/>
                    <line class="sun-ray" x1="12" y1="1" x2="12" y2="3"/>
                    <line class="sun-ray" x1="12" y1="21" x2="12" y2="23"/>
                    <line class="sun-ray" x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line class="sun-ray" x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line class="sun-ray" x1="1" y1="12" x2="3" y2="12"/>
                    <line class="sun-ray" x1="21" y1="12" x2="23" y2="12"/>
                    <line class="sun-ray" x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line class="sun-ray" x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            </button>

            <!-- Theme Dropdown Menu -->
            <div class="theme-dropdown" id="themeDropdown">
                <div class="theme-dropdown-content">
                    <button class="theme-option" data-theme="light" data-i18n="themeOptions.light" aria-label="Light theme">
                        <span class="theme-option-label">Light</span>
                    </button>
                    <button class="theme-option" data-theme="dark" data-i18n="themeOptions.dark" aria-label="Dark theme">
                        <span class="theme-option-label">Dark</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Theme and Language Initialization -->
        <script>
            // Setup language dropdown button
            function setupLanguageDropdown() {
                const languageToggle = document.getElementById('languageToggle');
                const languageDropdown = document.getElementById('languageDropdown');
                const languageOptions = document.querySelectorAll('.language-option');
                
                if (!languageToggle || !languageDropdown) {
                    console.warn('[UI] Language elements not found in DOM');
                    return;
                }
                
                console.log('[UI] Setting up language dropdown with', languageOptions.length, 'options');
                
                // Toggle dropdown on button click
                languageToggle.addEventListener('click', function(e) {
                    console.log('[UI] Language toggle button clicked');
                    e.preventDefault();
                    e.stopPropagation();
                    const isActive = languageDropdown.classList.contains('active');
                    languageDropdown.classList.toggle('active');
                    console.log('[UI] Language dropdown toggled to:', !isActive);
                });
                
                // Handle language option clicks
                languageOptions.forEach((option) => {
                    option.addEventListener('click', function(e) {
                        console.log('[UI] Language option clicked:', this.dataset.lang);
                        // Allow navigation to the link
                        // Close dropdown
                        languageDropdown.classList.remove('active');
                        console.log('[UI] Language dropdown closed');
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    // Only close if clicking outside the language selector
                    if (!e.target.closest('.language-selector')) {
                        languageDropdown.classList.remove('active');
                    }
                });
                
                console.log('[UI] Language dropdown setup complete');
            }
            
            // Setup theme toggle button
            function setupThemeToggle() {
                const themeToggle = document.getElementById('themeToggle');
                const themeDropdown = document.getElementById('themeDropdown');
                const themeOptions = document.querySelectorAll('.theme-option');
                
                if (!themeToggle || !themeDropdown) {
                    console.warn('[UI] Theme elements not found in DOM');
                    return;
                }
                
                console.log('[UI] Setting up theme toggle button with', themeOptions.length, 'options');
                
                // Toggle dropdown on button click
                themeToggle.addEventListener('click', function(e) {
                    console.log('[UI] Theme toggle button clicked');
                    e.preventDefault();
                    e.stopPropagation();
                    const isActive = themeDropdown.classList.contains('active');
                    themeDropdown.classList.toggle('active');
                    console.log('[UI] Dropdown toggled to:', !isActive);
                });
                
                // Handle theme option clicks
                themeOptions.forEach((option, index) => {
                    option.addEventListener('click', function(e) {
                        console.log('[UI] Theme option clicked:', this.dataset.theme);
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const theme = this.dataset.theme;
                        console.log('[UI] Calling ThemeManager.setTheme(' + theme + ')');
                        
                        // Call ThemeManager to change theme and save cookie
                        if (typeof ThemeManager !== 'undefined' && ThemeManager.setTheme) {
                            const success = ThemeManager.setTheme(theme);
                            console.log('[UI] ThemeManager.setTheme result:', success);
                            
                            if (success) {
                                // Update button to show current theme
                                console.log('[UI] Theme changed successfully to:', theme);
                            } else {
                                console.error('[UI] Failed to set theme');
                            }
                        } else {
                            console.error('[UI] ThemeManager not available');
                        }
                        
                        // Close dropdown
                        themeDropdown.classList.remove('active');
                        console.log('[UI] Dropdown closed');
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    // Only close if clicking outside the theme toggle container
                    if (!e.target.closest('.theme-toggle-container')) {
                        themeDropdown.classList.remove('active');
                    }
                });
                
                console.log('[UI] Theme toggle setup complete');
            }
            
            // Initialize language system and UI
            async function initializeLanguageUI() {
                try {
                    console.log('[Init] Starting language system initialization');
                    
                    // Wait for LanguageSystem to be ready
                    if (typeof LanguageSystem !== 'undefined') {
                        await LanguageSystem.init();
                        LanguageSystem.updatePageContent();
                        
                        // Update active state in language selector
                        const currentLang = LanguageSystem.getCurrentLanguage();
                        const toggleButton = document.querySelector('.language-toggle-button .language-current');
                        if (toggleButton) {
                            toggleButton.textContent = LanguageSystem.t('languageSelector.' + currentLang);
                        }
                        
                        console.log('[Init] Language system initialized for:', currentLang);
                    } else {
                        console.warn('[Init] LanguageSystem not available');
                    }
                } catch (error) {
                    console.error('[Init] Error initializing language system:', error);
                }
            }
            
            // Setup language dropdown immediately (before DOM content loaded)
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupLanguageDropdown);
            } else {
                setupLanguageDropdown();
            }
            
            // Setup theme toggle immediately (before DOM content loaded)
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupThemeToggle);
            } else {
                setupThemeToggle();
            }
            
            // Initialize language system when ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeLanguageUI);
            } else {
                initializeLanguageUI();
            }
        </script>
    </body>
</html>