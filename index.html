<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head lang="en">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="My personal website!">
    <meta name="author" content="Kooraseru" />

    <title>Kooraseru</title>
    <base href="/">

    <link rel="icon" href="public/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" />
    <link rel="stylesheet" href="frontend/src/css/stylesheet.css" />
    <link rel="stylesheet" href="frontend/src/css/themes.css" />
    <link rel="stylesheet" href="frontend/src/css/topbar.css" />

    <script type="module" src="frontend/src/js/theme-manager.js"></script>

    <script type="module" src="frontend/src/js/language-system.js"></script>
</head>

<body>
    <nav class="topbar">
        <div class="topbar-content">
            <div class="topbar-left">
                <div class="nav-links">
                    <button class="nav-link" data-i18n="nav.home" onclick="scrollToSection('welcome')"></button>
                    <button class="nav-link" data-i18n="nav.contact" onclick="scrollToSection('contact')"></button>
                </div>
            </div>
            <div class="topbar-center">
                <div class="logo" onclick="scrollToSection('welcome')" role="button" tabindex="0"
                    onkeydown="if(event.key==='Enter')scrollToSection('welcome')">
                    <img src="public/favicon.ico" class="logo-icon" alt="" data-i18n="topbar.logoAlt"
                        data-i18n-attr="alt" data-no-translate />
                    <span class="logo-text" data-no-translate>Kooraseru</span>
                </div>
            </div>
            <div class="topbar-right">
                <div class="language-selector">
                    <button class="language-toggle-button" id="languageToggle" aria-label=""
                        data-i18n="ui.languageToggle" data-i18n-attr="aria-label">
                        <span class="language-current" id="languageCurrent" data-lang="en"></span>
                        <svg class="language-icon" viewBox="0 0 24 24">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                    <div class="dropdown language-dropdown" id="languageDropdown">
                        <div class="dropdown-content">
                            <a class="dropdown-option language-option language-option-en" data-lang="en"
                                data-i18n="languageSelector.english"></a>
                            <a class="dropdown-option language-option language-option-ja" data-lang="ja"
                                data-i18n="languageSelector.japanese"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="page-scroller" id="pageScroller">
        <section class="section" id="welcome">
            <div class="container">
                <div class="welcome-card">
                    <h1 data-i18n="home.greeting"></h1>
                    <h2 data-i18n="home.welcome"></h2>
                    <p data-i18n="home.intro"></p>
                </div>
            </div>
        </section>
        <section class="section section--alt" id="portfolio">
            <div class="container">
                <div class="section-heading">
                    <h2 data-i18n="portfolio.title"></h2>
                    <p data-i18n="portfolio.subtitle"></p>
                </div>

                <div class="portfolio-controls">
                    <div class="sort-control">
                        <span class="sort-label" data-i18n="portfolio.sortLabel"></span>
                        <div class="sort-selector">
                            <button class="sort-toggle-button" id="sortToggle" aria-haspopup="listbox">
                                <span class="sort-current" id="sortCurrent" data-i18n="portfolio.sortNewest"></span>
                                <svg class="sort-icon" viewBox="0 0 24 24">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="dropdown sort-dropdown" id="sortDropdown">
                                <div class="dropdown-content">
                                    <button class="dropdown-option sort-option" data-sort="newest"
                                        data-i18n="portfolio.sortNewest"></button>
                                    <button class="dropdown-option sort-option" data-sort="oldest"
                                        data-i18n="portfolio.sortOldest"></button>
                                    <button class="dropdown-option sort-option" data-sort="active"
                                        data-i18n="portfolio.sortActive"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-nav">
                        <button class="carousel-btn" id="carouselPrev" aria-label="" data-i18n="ui.carouselPrev"
                            data-i18n-attr="aria-label">&#8592;</button>
                        <button class="carousel-btn" id="carouselNext" aria-label="" data-i18n="ui.carouselNext"
                            data-i18n-attr="aria-label">&#8594;</button>
                    </div>
                </div>

                <div class="carousel-track" id="projectsCarousel"></div>
                <div class="carousel-dots" id="carouselDots"></div>
            </div>
        </section>

        <section class="section" id="skills">
            <div class="container">
                <div class="section-heading">
                    <h2 data-i18n="skills.title"></h2>
                    <p data-i18n="skills.subtitle"></p>
                </div>
                <div class="skills-grid" id="skillsGrid"></div>
                <p style="color:var(--text-secondary);font-size:var(--font-size-sm);margin-top:var(--space-xl);text-align:center;max-width:600px;margin-left:auto;margin-right:auto"
                    data-i18n="skills.body">
                </p>
            </div>
        </section>
        <section class="section section--alt" id="experience">
            <div class="container">
                <div class="section-heading">
                    <h2 data-i18n="experience.title"></h2>
                    <p data-i18n="experience.subtitle"></p>
                </div>
                <div class="experience-timeline">
                    <div class="timeline-item">
                        <div class="timeline-left">
                            <div class="timeline-dot"></div>
                            <div class="timeline-line"></div>
                        </div>
                        <div class="timeline-right">
                            <div class="timeline-title" data-i18n="experience.entries.job1.company"></div>
                            <div class="timeline-meta" data-i18n="experience.entries.job1.duration"></div>
                            <p class="timeline-body" data-i18n="experience.entries.job1.description"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section" id="contact">
            <div class="container">
                <div class="section-heading">
                    <h2 data-i18n="contact.title"></h2>
                    <p data-i18n="contact.subtitle"></p>
                </div>
                <form class="contact-form" id="contactForm" onsubmit="sendContactForm(event);">
                    <div class="form-group">
                        <label class="form-label" for="contactEmail" data-i18n="contact.emailLabel"></label>
                        <input class="form-input" type="email" id="contactEmail" placeholder=""
                            data-i18n="contact.emailPlaceholder" data-i18n-attr="placeholder" autocomplete="email" />
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="contactMessage" data-i18n="contact.messageLabel"></label>
                        <textarea class="form-textarea" id="contactMessage" placeholder=""
                            data-i18n="contact.messagePlaceholder" data-i18n-attr="placeholder"></textarea>
                    </div>
                    <button class="form-submit" type="submit" data-i18n="contact.sendButton"></button>
                </form>
            </div>
        </section>

    </div>

    <div class="project-modal-overlay" id="projectModal" role="dialog" aria-modal="true" aria-label=""
        data-i18n="ui.projectModal" data-i18n-attr="aria-label">
        <div class="project-modal">
            <button class="project-modal-close" id="projectModalClose" aria-label="" data-i18n="ui.close"
                data-i18n-attr="aria-label">&times;</button>
            <div id="projectModalContent"></div>
        </div>
    </div>

    <div class="theme-toggle-container">
        <button class="theme-toggle-button" id="themeToggle" aria-label="" data-i18n="ui.themeOptions"
            data-i18n-attr="aria-label">
            <svg class="theme-icon" viewBox="0 0 24 24">
                <circle class="sun-circle" cx="12" cy="12" r="5" />
                <line class="sun-ray" x1="12" y1="1" x2="12" y2="3" />
                <line class="sun-ray" x1="12" y1="21" x2="12" y2="23" />
                <line class="sun-ray" x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                <line class="sun-ray" x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                <line class="sun-ray" x1="1" y1="12" x2="3" y2="12" />
                <line class="sun-ray" x1="21" y1="12" x2="23" y2="12" />
                <line class="sun-ray" x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                <line class="sun-ray" x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
            </svg>

            <span class="theme-button-content">
                <div class="theme-selector" id="themeSelector">
                    <span class="theme-current" data-i18n="themeOptions.dark"></span>
                    <svg class="theme-dropdown-icon" viewBox="0 0 24 24">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="theme-divider"></div>
                <div class="particle-toggle-inline">
                    <span class="particle-toggle-label" data-i18n="particleToggle.label"></span>
                    <label class="switch">
                        <input type="checkbox" id="particleToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </span>
        </button>

        <div class="dropdown theme-dropdown" id="themeDropdown">
            <div class="dropdown-content">
                <button class="dropdown-option theme-option" data-theme="light" data-i18n="themeOptions.light"></button>
                <button class="dropdown-option theme-option" data-theme="dark" data-i18n="themeOptions.dark"></button>
            </div>
        </div>
    </div>

    <script>
        function scrollToSection(id) {
            const scroller = document.getElementById('pageScroller');
            const target = document.getElementById(id);
            if (scroller && target) {
                scroller.scrollTo({ top: target.offsetTop, behavior: 'smooth' });
            }
        }
    </script>

    <script>
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const themeSelector = document.getElementById('themeSelector');
            const themeDropdown = document.getElementById('themeDropdown');
            const themeOptions = document.querySelectorAll('.theme-option');
            const themeCurrent = document.querySelector('.theme-current');
            if (!themeToggle || !themeDropdown) return;

            themeToggle.addEventListener('click', function (e) {
                if (e.target.closest('.theme-selector') || e.target.closest('.particle-toggle-inline')) return;
                e.preventDefault(); e.stopPropagation();
                const wasExpanded = themeToggle.classList.contains('expanded');
                themeToggle.classList.toggle('expanded');
                if (wasExpanded) themeDropdown.classList.remove('active');
            });

            if (themeSelector) {
                themeSelector.addEventListener('click', function (e) {
                    e.preventDefault(); e.stopPropagation();
                    themeDropdown.classList.toggle('active');
                });
            }

            themeOptions.forEach(function (option) {
                option.addEventListener('click', function (e) {
                    e.preventDefault(); e.stopPropagation();
                    const theme = this.dataset.theme;
                    if (typeof ThemeManager !== 'undefined' && ThemeManager.setTheme) {
                        const ok = ThemeManager.setTheme(theme);
                        if (ok && themeCurrent) {
                            const label = this.querySelector('span') ? this.querySelector('span').textContent : this.textContent;
                            themeCurrent.textContent = label;
                            themeCurrent.dataset.i18n = this.dataset.i18n;
                        }
                    }
                    themeDropdown.classList.remove('active');
                });
            });

            document.addEventListener('click', function (e) {
                if (!e.target.closest('.theme-toggle-container')) {
                    themeDropdown.classList.remove('active');
                    themeToggle.classList.remove('expanded');
                }
            });

            if (themeCurrent && typeof ThemeManager !== 'undefined') {
                const cur = ThemeManager.getCurrentTheme() || 'dark';
                const opt = document.querySelector('.theme-option[data-theme="' + cur + '"]');
                if (opt) {
                    const label = opt.querySelector('span') ? opt.querySelector('span').textContent : opt.textContent;
                    themeCurrent.textContent = label;
                    themeCurrent.dataset.i18n = opt.dataset.i18n;
                }
            }
        }

        function setupParticleToggle() {
            var particleToggle = document.getElementById('particleToggle');
            if (!particleToggle) return;
            particleToggle.addEventListener('change', function () {
                if (this.checked) { if (typeof Confetti !== 'undefined') Confetti.playSnow(); }
                else { if (typeof Confetti !== 'undefined') Confetti.stopSnow(); }
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () { setupThemeToggle(); setupParticleToggle(); });
        } else { setupThemeToggle(); setupParticleToggle(); }
    </script>

    <script>
        function setupLanguageDropdown() {
            var languageToggle = document.getElementById('languageToggle');
            var languageCurrent = document.getElementById('languageCurrent');
            var languageDropdown = document.getElementById('languageDropdown');
            var languageOptions = document.querySelectorAll('.language-option');
            if (!languageToggle || !languageDropdown) return;

            languageToggle.addEventListener('click', function (e) {
                e.preventDefault(); e.stopPropagation();
                languageDropdown.classList.toggle('active');
            });

            languageOptions.forEach(function (option) {
                option.addEventListener('click', async function (e) {
                    e.preventDefault(); e.stopPropagation();
                    var selectedLang = this.dataset.lang;
                    if (typeof LanguageSystem !== 'undefined' && LanguageSystem.switchLanguage) {
                        var ok = await LanguageSystem.switchLanguage(selectedLang);
                        if (ok && languageCurrent) {
                            languageCurrent.textContent = this.textContent;
                            languageCurrent.dataset.lang = selectedLang;
                            languageCurrent.style.fontFamily = window.getComputedStyle(this).fontFamily;
                        }
                    }
                    languageDropdown.classList.remove('active');
                });
            });

            document.addEventListener('click', function (e) {
                if (!e.target.closest('.language-selector')) languageDropdown.classList.remove('active');
            });
        }

        async function initializeLanguageUI() {
            try {
                if (typeof LanguageSystem !== 'undefined') {
                    if (!window.translations) {
                        await LanguageSystem.init();
                    }
                    LanguageSystem.updatePageContent();

                    var currentLang = LanguageSystem.getCurrentLanguage();
                    var langCurrent = document.getElementById('languageCurrent');
                    if (langCurrent) {
                        var matchOpt = document.querySelector('.language-option[data-lang="' + currentLang + '"]');
                        if (matchOpt) {
                            langCurrent.textContent = matchOpt.textContent;
                            langCurrent.dataset.lang = currentLang;
                            langCurrent.style.fontFamily = window.getComputedStyle(matchOpt).fontFamily;
                        }
                    }
                }
            } catch (err) { console.error('[Init] Language UI error:', err); }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () { setupLanguageDropdown(); initializeLanguageUI(); });
        } else { setupLanguageDropdown(); initializeLanguageUI(); }
    </script>

    <script>
        async function sendContactForm(e) {
            e.preventDefault();

            const form = document.getElementById('contactForm');
            const name = (document.getElementById('contactName')?.value || '').trim();
            const email = (document.getElementById('contactEmail')?.value || '').trim();
            const message = (document.getElementById('contactMessage')?.value || '').trim();

            const emptyMessage = (typeof LanguageSystem !== 'undefined' && LanguageSystem.t)
                ? LanguageSystem.t('contact.toastEmptyMessage', 'Please write a message first.')
                : 'Please write a message first.';
            const sentMessage = (typeof LanguageSystem !== 'undefined' && LanguageSystem.t)
                ? LanguageSystem.t('contact.toastSent', 'Message sent!')
                : 'Message sent!';

            if (!message) {
                showToast(emptyMessage, 'error');
                return;
            }

            const formData = { name, email, message };

            try {
                const res = await fetch('https://contact.kooraseru.com/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await res.json();
                if (result.success) {
                    showToast(sentMessage);
                    form.reset();
                } else {
                    showToast('Failed to send message.', 'error');
                }
            } catch (err) {
                console.error(err);
                showToast('Error sending message.', 'error');
            }
        }

        function showToast(message, type) {
            var existing = document.getElementById('toastNotification');
            if (existing) existing.remove();

            var toast = document.createElement('div');
            toast.id = 'toastNotification';
            toast.className = 'toast' + (type === 'error' ? ' toast--error' : '');
            toast.textContent = message;
            document.body.appendChild(toast);

            requestAnimationFrame(() => { requestAnimationFrame(() => { toast.classList.add('toast--visible'); }); });

            setTimeout(function () {
                toast.classList.remove('toast--visible');
                toast.addEventListener('transitionend', function () { toast.remove(); }, { once: true });
            }, 3000);
        }
    </script>

    <script>if (typeof module === 'undefined') { var module = { exports: {} }; }</script>
    <script src="frontend/src/js/confetti.js"></script>
    <script>if (typeof module !== 'undefined' && module.exports) { window.confetti = module.exports; }</script>
    <script src="frontend/src/js/confetti-manager.js"></script>

    <script src="frontend/src/js/projects.js"></script>
    <script src="frontend/src/js/skills.js"></script>

</body>

</html>