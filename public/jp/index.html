<!DOCTYPE html>
<html lang="ja" data-theme="dark">
    <!--
        Kooraseru - 日本語版
        言語属性を「ja」に設定
        キャラクタエンコーディングをUTF-8に設定
        アイコンを .github/resources/kooraseru.ico に設定
        レスポンシブデザイン用のビューポートメタタグを含める
        スタイルシートをリンク
    -->
    <head lang="ja">
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Kooraseru - WebAssembly対応の多言語プラットフォーム">
        
        <title>Kooraseru</title>
        <base href="/">

        <link rel="icon" href="/.github/resources/kooraseru.ico" type="image/x-icon" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&GoogleSans:wght@400;500;700&display=swap" />
        <link rel="stylesheet" href="/.github/resources/stylesheet.css" />
        <link rel="stylesheet" href="/.github/resources/themes.css" />
        <link rel="stylesheet" href="/.github/resources/topbar.css" />
        
        <!-- Theme helper - runs immediately to prevent flash -->
        <script src="/js/theme-helper.js"></script>
    </head>
    <body>
        <!-- Top Navigation Bar -->
        <nav class="topbar">
            <div class="topbar-content">
                <div class="topbar-left">
                    <a href="/" class="logo">
                        <img src="/.github/resources/kooraseru.ico" alt="Kooraseru" class="logo-icon" />
                        <span class="logo-text">Kooraseru</span>
                    </a>
                </div>
                
                <div class="topbar-center">
                    <!-- Will be populated dynamically -->
                </div>
                
                <div class="topbar-right">
                    <div class="language-selector">
                        <a href="https://kooraseru.com" class="lang-link" data-lang="en">English</a>
                        <span class="lang-separator">/</span>
                        <a href="/" class="lang-link active" data-lang="jp">日本語</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Ribbon -->
        <div class="ribbon">
            <div class="ribbon-content">
                <!-- Placeholder for ribbon content -->
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="content">
            <div class="container">
                <!-- Content will be loaded here -->
            </div>
        </main>

        <!-- Theme Toggle Button -->
        <div class="theme-toggle-container">
            <button class="theme-toggle-button" id="themeToggle" aria-label="テーマを選択">
                <svg class="theme-icon" viewBox="0 0 24 24" fill="currentColor">
                    <!-- Sun icon for light theme -->
                    <circle class="sun-circle" cx="12" cy="12" r="5"/>
                    <line class="sun-ray" x1="12" y1="1" x2="12" y2="3"/>
                    <line class="sun-ray" x1="12" y1="21" x2="12" y2="23"/>
                    <line class="sun-ray" x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line class="sun-ray" x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line class="sun-ray" x1="1" y1="12" x2="3" y2="12"/>
                    <line class="sun-ray" x1="21" y1="12" x2="23" y2="12"/>
                    <line class="sun-ray" x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line class="sun-ray" x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                </svg>
            </button>

            <!-- Theme Dropdown Menu -->
            <div class="theme-dropdown" id="themeDropdown">
                <div class="theme-dropdown-content">
                    <button class="theme-option" data-theme="light" aria-label="ライトテーマ">
                        <span class="theme-option-label">ライト</span>
                    </button>
                    <button class="theme-option" data-theme="dark" aria-label="ダークテーマ">
                        <span class="theme-option-label">ダーク</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- WebAssembly Module -->
        <script type="module">
            import init, { init_theme_system, set_theme } from '/../kooraseru.js';
            
            async function run() {
                try {
                    await init();
                    init_theme_system();
                } catch (e) {
                    console.warn('WebAssembly module failed to load:', e);
                    // ThemeHelper will provide fallback functionality
                }
                
                // Setup theme toggle
                const themeToggle = document.getElementById('themeToggle');
                const themeDropdown = document.getElementById('themeDropdown');
                const themeOptions = document.querySelectorAll('.theme-option');
                
                themeToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    themeDropdown.classList.toggle('active');
                });
                
                themeOptions.forEach(option => {
                    option.addEventListener('click', (e) => {
                        const theme = e.currentTarget.dataset.theme;
                        try {
                            set_theme(theme);
                        } catch (e) {
                            console.warn('Wasm set_theme failed, using fallback:', e);
                            ThemeHelper.setTheme(theme);
                        }
                        themeDropdown.classList.remove('active');
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', () => {
                    themeDropdown.classList.remove('active');
                });
            }
            
            run();
        </script>
    </body>
</html>